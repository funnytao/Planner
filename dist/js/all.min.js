function renderMap(){google.maps.event.trigger(map,"resize")}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:-33.8688,lng:151.2195},zoom:13,disableDefaultUI:!0});var e=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(e);var t=new google.maps.places.Autocomplete(e);t.bindTo("bounds",map);var n=new google.maps.InfoWindow,s=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});t.addListener("place_changed",function(){n.close(),s.setVisible(!1);var e=t.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17)),s.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),s.setPosition(e.geometry.location),s.setVisible(!0);var o="";e.address_components&&(o=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),n.setContent("<div><strong>"+e.name+"</strong><br>"+o),n.open(map,s)})}function addguest(){console.log("created!");var e=document.createElement("div");e.setAttribute("class","row");var t=document.createElement("div");t.setAttribute("class","inputprefix"),t.appendChild(document.createTextNode("Guest"));var n=document.getElementById("guest"),s=document.createElement("input");s.required=!0,s.setAttribute("class","guestlist"),s.setAttribute("type","text"),s.setAttribute("placeholder","Who is invited?");var o=document.createElement("div");o.setAttribute("class","rightbutton");var r=document.createElement("span");r.setAttribute("class","glyphicon glyphicon-minus"),r.setAttribute("onclick","deleteguest(this)"),o.appendChild(r),e.appendChild(t),e.appendChild(s),e.appendChild(o),n.appendChild(e)}function deleteguest(e){var t=document.getElementById("guest");t.childNodes.length>1&&(console.log(e.parentElement.parentElement),e.parentElement.parentElement.remove())}function addnew(){document.querySelector(".showEvents").style.display="none",document.querySelector(".planner").style.display="block",clearGuests(),addguest(),renderMap()}function clearGuests(){var e=document.getElementById("guest");e.innerHTML="",console.log("cleared"),$("input").val("")}function returnToEvents(){document.querySelector(".planner").style.display="none",document.querySelector(".showEvents").style.display="block",showEvents()}function createPanel(e,t){var n=document.createElement("div");n.setAttribute("class","panel panel-default");var s=document.createElement("div");s.setAttribute("class","panel-body");var o=document.createElement("h2");o.appendChild(document.createTextNode(e.eventname)),s.appendChild(o);var r=document.createElement("a");r.setAttribute("class","deleteEvent"),r.setAttribute("name",t),r.setAttribute("onclick","deleteEvent(this.name)");var a=document.createElement("span");a.setAttribute("class","glyphicon glyphicon-trash"),r.appendChild(a),s.appendChild(r);var i=document.createElement("div");s.appendChild(i);var l=document.createElement("div");l.setAttribute("class","panel-footer");var d=document.createElement("div");d.setAttribute("class","row");var c=document.createElement("p");c.setAttribute("class","tag"),c.appendChild(document.createTextNode("From")),d.appendChild(c);var u=document.createElement("p");u.setAttribute("class","data"),u.appendChild(document.createTextNode(e.start)),d.appendChild(u);var m=document.createElement("p");m.setAttribute("class","tag todiv"),m.appendChild(document.createTextNode("To")),d.appendChild(m);var p=document.createElement("p");p.setAttribute("class","data"),p.appendChild(document.createTextNode(e.end)),d.appendChild(p);var g=document.createElement("div");g.setAttribute("class","row");var h=document.createElement("p");h.setAttribute("class","tag"),h.appendChild(document.createTextNode("Host")),g.appendChild(h);var v=document.createElement("p");v.setAttribute("class","data"),v.appendChild(document.createTextNode(e.host)),g.appendChild(v);var f=document.createElement("div");f.setAttribute("class","row");var b=document.createElement("p");b.setAttribute("class","tag"),b.appendChild(document.createTextNode("Guests")),f.appendChild(b);var w="";e.guests.forEach(function(e){w=w+e+", "});var y=document.createElement("p");y.setAttribute("class","data"),y.appendChild(document.createTextNode(w.substring(0,w.length-3))),f.appendChild(y),l.appendChild(g),l.appendChild(f),l.appendChild(d);var E=document.createElement("div");E.setAttribute("id",t),E.setAttribute("class","map"),l.appendChild(E),n.appendChild(s),n.appendChild(l),document.getElementById("events").appendChild(n),displayMap(t,e.address)}function deleteEvent(e){console.log(e);var t=new Firebase("https://boiling-heat-4273.firebaseio.com"),n=t.getAuth();n&&new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+n.uid+"/events/"+e).remove(),showEvents()}function showEvents(){var e=document.getElementById("events");e.innerHTML="";var t=new Firebase("https://boiling-heat-4273.firebaseio.com"),n=t.getAuth();if(n){var s=new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+n.uid+"/events");s.orderByChild("start").on("value",function(e){e.forEach(function(e){createPanel(e.val(),e.key())})})}}function displayMap(e,t){var n=new google.maps.Map(document.getElementById(e),{zoom:18,center:{lat:-34.397,lng:150.644},draggable:!1,scrollwheel:!1,disableDefaultUI:!0,disableDoubleClickZoom:!0}),s=new google.maps.Geocoder;s.geocode({address:t},function(e,s){if(s===google.maps.GeocoderStatus.OK){n.setCenter(e[0].geometry.location);var o=new google.maps.Marker({map:n,position:e[0].geometry.location}),r=new google.maps.InfoWindow({maxWidth:180});r.setContent("<div><strong>"+t.split(",")[0]+"</strong><br>"+t),r.open(n,o)}else alert("Geocode was not successful for the following reason: "+s)})}function IssueTracker(){this.issues=[]}function showComponents(){document.querySelector(".welcome").style.display="none",document.querySelector(".showEvents").style.display="block",showEvents()}var map;$("#start").datetimepicker({format:"MM/dd/yyyy hh:mm",language:"en"}),$("#end").datetimepicker({format:"MM/dd/yyyy hh:mm",language:"en"}),document.querySelector("#addevent").onclick=function(){console.log("adding events");var e=[],t=document.getElementById("guest");for(console.log(e.length),i=0;i<t.childNodes.length;i++){var n=t.childNodes[i].firstChild.nextSibling.value;void 0!==n&&e.push(n)}var s=new Firebase("https://boiling-heat-4273.firebaseio.com"),o=s.getAuth();if(console.log(e.length),o&&e.length>0){var r=new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+o.uid+"/events");r.push().set({eventname:document.getElementById("event").value,host:document.getElementById("host").value,start:document.getElementById("start-time").value,end:document.getElementById("end-time").value,guests:e,address:document.getElementById("pac-input").value}),returnToEvents()}};var loggedin=!1,userid,ref=new Firebase("https://boiling-heat-4273.firebaseio.com"),url="https://boiling-heat-4273.firebaseio.com/web/planner/users/",loginWindow=document.querySelector("#tologin"),regWindow=document.querySelector("#toreg"),regUsernameInput=document.querySelector("#regusername");loginWindow.onclick=function(){document.getElementById("register-form").style.display="none",document.getElementById("login-form").style.display="block",document.getElementById("username").focus()},regWindow.onclick=function(){document.getElementById("login-form").style.display="none",document.getElementById("register-form").style.display="block",document.getElementById("regusername").focus()};var submitLogin=document.querySelector("#login-button"),submitReg=document.querySelector("#register-button"),firstPasswordInput=document.querySelector("#firstPassword"),secondPasswordInput=document.querySelector("#secondPassword");IssueTracker.prototype={add:function(e){this.issues.push(e)},retrieve:function(){var e="";switch(this.issues.length){case 0:break;case 1:e="Please correct the following issue:\n"+this.issues[0];break;default:e="Please correct the following issues:\n"+this.issues.join("\n")}return e}};var usernameError="",emailError="",firstInputIssuesTracker=new IssueTracker,secondInputIssuesTracker=new IssueTracker,dupuser=!1;$("#regusername").on("input",function(){dupuser=!1;var e=regUsernameInput.value;usernameError=e.match(/[^A-z0-9]/g)?"Cannot contains elements other than letters and numbers.":"";var t=new Firebase(url);t.once("value",function(t){t.forEach(function(t){t.child("username").val()===e&&(dupuser=!0,usernameError="Username Already Exists.")})}),usernameError.length>0?($("#regusername").attr("title",usernameError).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#regusername").css("background-color","rgb(247, 215, 216)")):($("#regusername").tooltip("hide"),$("#regusername").removeAttr("title"),$("#regusername").css("background-color","white")),console.log(usernameError),regUsernameInput.setCustomValidity("")}),$("#firstPassword").on("input",function(){var e=firstPasswordInput.value;firstInputIssuesTracker=new IssueTracker,function(){e.length<8?firstInputIssuesTracker.add("Fewer than 8 characters."):e.length>100&&firstInputIssuesTracker.add("Greater than 100 characters."),e.match(/\d/g)||firstInputIssuesTracker.add("Missing a number."),e.match(/[a-z]/g)||firstInputIssuesTracker.add("Missing a lowercase letter."),e.match(/[A-Z]/g)||firstInputIssuesTracker.add("Missing an uppercase letter.");var t=e.match(/[^A-z0-9\!\@\#\$\%\^\&\*]/g);t&&t.forEach(function(e){firstInputIssuesTracker.add("Contains an illegal character: "+e+".")})}();var t=firstInputIssuesTracker.retrieve();console.log(t),t.length>0?($("#firstPassword").attr("title",t).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#firstPassword").css("background-color","rgb(247, 215, 216)")):($("#firstPassword").tooltip("hide"),$("#firstPassword").removeAttr("title"),$("#firstPassword").css("background-color","white"))}),$("#secondPassword").on("input",function(){var e=secondPasswordInput.value;secondInputIssuesTracker=new IssueTracker,e!==firstPasswordInput.value&&secondInputIssuesTracker.add("Passwords not matched.");var t=secondInputIssuesTracker.retrieve()||"";console.log("["+t+"]"),t.length>0?(console.log("still..."),$("#secondPassword").attr("title",t).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#secondPassword").css("background-color","rgb(247, 215, 216)")):($("#secondPassword").tooltip("hide"),$("#secondPassword").removeAttr("title"),$("#secondPassword").css("background-color","white"))}),submitReg.onclick=function(){submitReg.setCustomValidity(""),secondInputIssuesTracker.issues.length+firstInputIssuesTracker.issues.length!==0||""!==usernameError||dupuser?dupuser?(console.log("dup"),regUsernameInput.setCustomValidity("Username has already been used.")):(console.log("eeeeeeeerror"),submitReg.setCustomValidity("Please Validate Your Information.")):ref.createUser({email:document.querySelector("#email").value,password:secondPasswordInput.value},function(e,t){e?alert(e):(console.log("Successfully created user account with uid:",t.uid),new Firebase(url).child(t.uid).set({username:regUsernameInput.value,events:[]}),alert("Account Created!"),loggedin=!0,showComponents())})},submitLogin.onclick=function(){console.log("clicked");ref.authWithPassword({email:document.querySelector("#username").value,password:document.querySelector("#password").value},function(e,t){e?alert(e):(console.log("Authenticated successfully with payload:",t.uid),userid=t.uid,loggedin=!0,showComponents())})},$(document).tooltip({selector:"[title]",placement:"right",trigger:"focus",animation:!1});