function renderMap(){google.maps.event.trigger(map,"resize")}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:-33.8688,lng:151.2195},zoom:13,disableDefaultUI:!0});var e=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(e);var t=new google.maps.places.Autocomplete(e);t.bindTo("bounds",map);var o=new google.maps.InfoWindow,n=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});t.addListener("place_changed",function(){o.close(),n.setVisible(!1);var e=t.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17)),n.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),n.setPosition(e.geometry.location),n.setVisible(!0);var r="";e.address_components&&(r=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),o.setContent("<div><strong>"+e.name+"</strong><br>"+r),o.open(map,n)})}function addguest(){var e=new Date,t=e.getTime();console.log("created!");var o=document.createElement("div");o.setAttribute("class","row");var n=document.createElement("label");n.setAttribute("class","inputprefix"),n.setAttribute("for",t),n.appendChild(document.createTextNode("Guest"));var r=document.getElementById("guest"),s=document.createElement("input");s.required=!0,s.setAttribute("title",""),s.setAttribute("class","guestlist"),s.setAttribute("type","text"),s.setAttribute("id",t),s.setAttribute("placeholder","Who is invited?");var a=document.createElement("div");a.setAttribute("class","rightbutton");var i=document.createElement("span");i.setAttribute("class","glyphicon glyphicon-minus"),i.setAttribute("onclick","deleteguest(this)"),a.appendChild(i),o.appendChild(n),o.appendChild(s),o.appendChild(a),r.appendChild(o),$("#"+t).on("input",function(){checkEmpty(t,!1)})}function deleteguest(e){var t=document.getElementById("guest");t.childNodes.length>1&&(console.log(e.parentElement.parentElement),e.parentElement.parentElement.remove())}function checkEmpty(e,t){var o=document.getElementById(e).value,n="";return""===o?(console.log("isempty"),n="Value cannot be empty.",$("#"+e).attr("title",n).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#"+e).css("background-color","rgb(247, 215, 216)"),t=!0,console.log("error:"+t)):(console.log("notempty"),$("#"+e).tooltip("hide"),$("#"+e).removeAttr("title"),$("#"+e).css("background-color","white")),t}function checkEventEmpty(){var e=document.getElementById("event").value,t="";""===e?(console.log("isempty"),t="Value cannot be empty.",$("#event").attr("title",t).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#event").css("background-color","rgb(247, 215, 216)")):(console.log("notempty"),$("#event").tooltip("hide"),$("#event").removeAttr("title"),$("#event").css("background-color","white"))}function checkdate(e){var t=document.getElementById("start-time").value,o=document.getElementById("end-time").value,n="";return""!==t&&""!==o&&(t>o?(n="Start time should be earlier than end time.",console.log("reversed..."),$("#start-time").attr("title",n).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#start-time").css("background-color","rgb(247, 215, 216)"),e=!0,console.log("error:"+e)):(console.log("safe"),$("#start-time").attr("title",""),$("#start-time").tooltip("hide"),$("#start-time").removeAttr("title"),$("#start-time").css("background-color","white"))),e}function addnew(){document.querySelector(".showEvents").style.display="none",document.querySelector(".planner").style.display="block",clearGuests(),addguest(),renderMap(),document.getElementById("event").focus(),$(".planner input").tooltip({selector:"[title]",placement:"bottom",trigger:"focus",animation:!1})}function clearGuests(){var e=document.getElementById("guest");e.innerHTML="",console.log("cleared"),$("input").val("")}function returnToEvents(){$(".planner input").tooltip("destroy"),document.querySelector(".planner").style.display="none",document.querySelector(".showEvents").style.display="block",showEvents()}function createPanel(e,t){var o=document.createElement("div");o.setAttribute("class","panel panel-default");var n=document.createElement("div");n.setAttribute("class","panel-body");var r=document.createElement("h2");r.appendChild(document.createTextNode(e.eventname)),n.appendChild(r);var s=document.createElement("a");if(s.setAttribute("class","deleteEvent"),s.setAttribute("name",t),s.setAttribute("onclick","deleteEvent(this.name)"),e.important){var a=document.createElement("span");a.setAttribute("class","glyphicon glyphicon-star"),s.appendChild(a)}var i=document.createElement("span");i.setAttribute("class","glyphicon glyphicon-trash"),s.appendChild(i),n.appendChild(s);var l=document.createElement("div");n.appendChild(l);var c=document.createElement("div");c.setAttribute("class","panel-footer");var d=document.createElement("div");d.setAttribute("class","row");var u=document.createElement("p");u.setAttribute("class","tag"),u.appendChild(document.createTextNode("From")),d.appendChild(u);var m=document.createElement("p");m.setAttribute("class","data"),m.appendChild(document.createTextNode(e.start)),d.appendChild(m);var p=document.createElement("p");p.setAttribute("class","tag todiv"),p.appendChild(document.createTextNode("To")),d.appendChild(p);var g=document.createElement("p");g.setAttribute("class","data"),g.appendChild(document.createTextNode(e.end)),d.appendChild(g);var h=document.createElement("div");h.setAttribute("class","row");var v=document.createElement("p");v.setAttribute("class","tag"),v.appendChild(document.createTextNode("Host")),h.appendChild(v);var f=document.createElement("p");f.setAttribute("class","data"),f.appendChild(document.createTextNode(e.host)),h.appendChild(f);var y=document.createElement("div");y.setAttribute("class","row");var b=document.createElement("p");b.setAttribute("class","tag"),b.appendChild(document.createTextNode("Guests")),y.appendChild(b);var w="";e.guests.forEach(function(e){w=w+e+", "});var E=document.createElement("p");if(E.setAttribute("class","data"),E.appendChild(document.createTextNode(w.substring(0,w.length-3))),y.appendChild(E),e.note.length>0){var I=document.createElement("div");I.setAttribute("class","row");var k=document.createElement("p");k.setAttribute("class","tag"),k.appendChild(document.createTextNode("Note")),I.appendChild(k);var $=document.createElement("p");$.setAttribute("class","data"),$.appendChild(document.createTextNode(e.note)),I.appendChild($)}c.appendChild(h),c.appendChild(y),e.note.length>0&&c.appendChild(I),c.appendChild(d);var C=document.createElement("div");C.setAttribute("id",t),C.setAttribute("class","map"),c.appendChild(C),o.appendChild(n),o.appendChild(c),document.getElementById("events").appendChild(o),displayMap(t,e.address)}function deleteEvent(e){console.log(e);var t=new Firebase("https://boiling-heat-4273.firebaseio.com"),o=t.getAuth();o&&new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+o.uid+"/events/"+e).remove(),showEvents()}function showEvents(){var e=document.getElementById("events");e.innerHTML="";var t=new Firebase("https://boiling-heat-4273.firebaseio.com"),o=t.getAuth();if(o){var n=new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+o.uid+"/events");n.orderByChild("start").on("value",function(e){e.forEach(function(e){createPanel(e.val(),e.key())})})}}function displayMap(e,t){var o=new google.maps.Map(document.getElementById(e),{zoom:18,center:{lat:-34.397,lng:150.644},draggable:!1,scrollwheel:!1,disableDefaultUI:!0,disableDoubleClickZoom:!0}),n=new google.maps.Geocoder;n.geocode({address:t},function(e,n){if(n===google.maps.GeocoderStatus.OK){o.setCenter(e[0].geometry.location);var r=new google.maps.Marker({map:o,position:e[0].geometry.location}),s=new google.maps.InfoWindow({maxWidth:140});s.setContent("<div><strong>"+t.split(",")[0]+"</strong><br>"+t),s.open(o,r)}else alert("Geocode was not successful for the following reason: "+n)})}function IssueTracker(){this.issues=[]}function usernameValid(){var e=regUsernameInput.value;usernameError=""===e?"Username cannot be empty!":"",usernameError=e.match(/[^A-z0-9]/g)?"Cannot contains elements other than letters and numbers.":usernameError;var t=new Firebase(url);t.once("value",function(t){t.forEach(function(t){console.log("here: "+t.child("username").val()+"  "+e),""!==t.child("username").val()&&t.child("username").val()===e&&(usernameError="Username Already Exists.")})}).then(function(){usernameError.length>0?($("#regusername").attr("title",usernameError).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#regusername").css("background-color","rgb(247, 215, 216)")):($("#regusername").tooltip("hide"),$("#regusername").removeAttr("title"),$("#regusername").css("background-color","white")),console.log(usernameError)})}function emailValid(){var e=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,t=document.getElementById("email").value;emailError=e.test(t)?"":"Email address is not valid.",emailError=""===t?"Email cannot be empty!":"";var o=new Firebase(url);o.once("value",function(e){e.forEach(function(e){console.log("here: "+e.child("email").val()+"  "+t),""!==e.child("email").val()&&e.child("email").val()===t&&(emailError="Email Already Exists.")})}).then(function(){emailError.length>0?($("#email").attr("title",emailError).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#email").css("background-color","rgb(247, 215, 216)")):($("#email").tooltip("hide"),$("#email").removeAttr("title"),$("#email").css("background-color","white")),console.log(emailError)})}function firstPasswordValid(){var e=firstPasswordInput.value;firstInputIssuesTracker=new IssueTracker,function(){e.length<8?firstInputIssuesTracker.add("Fewer than 8 characters."):e.length>100&&firstInputIssuesTracker.add("Greater than 100 characters."),e.match(/\d/g)||firstInputIssuesTracker.add("Missing a number."),e.match(/[a-z]/g)||firstInputIssuesTracker.add("Missing a lowercase letter."),e.match(/[A-Z]/g)||firstInputIssuesTracker.add("Missing an uppercase letter.");var t=e.match(/[^A-z0-9\!\@\#\$\%\^\&\*]/g);t&&t.forEach(function(e){firstInputIssuesTracker.add("Contains an illegal character: "+e+".")})}();var t=firstInputIssuesTracker.retrieve();console.log(t),t.length>0?($("#firstPassword").attr("title",t).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#firstPassword").css("background-color","rgb(247, 215, 216)")):($("#firstPassword").tooltip("hide"),$("#firstPassword").removeAttr("title"),$("#firstPassword").css("background-color","white"))}function secondPasswordValid(){var e=secondPasswordInput.value;secondInputIssuesTracker=new IssueTracker,e!==firstPasswordInput.value&&secondInputIssuesTracker.add("Passwords not matched.");var t=secondInputIssuesTracker.retrieve()||"";console.log("["+t+"]"),t.length>0?(console.log("still..."),$("#secondPassword").attr("title",t).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#secondPassword").css("background-color","rgb(247, 215, 216)")):($("#secondPassword").tooltip("hide"),$("#secondPassword").removeAttr("title"),$("#secondPassword").css("background-color","white"))}function loginuserValid(){var e=document.getElementById("username").value;loginuserError=""===e?"Email cannot be empty!":"";var t=new Firebase(url);t.once("value",function(t){var o=!1;t.forEach(function(t){""!==t.child("email").val()&&t.child("email").val()===e&&(o=!0)}),o||""===e||(loginuserError="Account does not exists.")}).then(function(){loginuserError.length>0?($("#username").attr("title",loginuserError).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#username").css("background-color","rgb(247, 215, 216)")):($("#username").tooltip("hide"),$("#username").removeAttr("title"),$("#username").css("background-color","white")),console.log(loginuserError)})}function loginpassValid(e){var t=document.getElementById("password").value;loginpassError=""===t?"Please enter your password.":e,loginpassError.length>0?($("#password").attr("title",loginpassError).tooltip("fixTitle").tooltip("setContent").tooltip({trigger:"focus"}).tooltip("show"),$("#password").css("background-color","rgb(247, 215, 216)")):($("#password").tooltip("hide"),$("#password").removeAttr("title"),$("#password").css("background-color","white"))}function showComponents(){console.log(authusername),document.querySelector(".welcome").style.display="none",document.querySelector(".showEvents").style.display="block",document.getElementById("authusername").innerHTML=authusername,$(".welcome input").tooltip("destroy"),showEvents()}var map;$("#start").datetimepicker({format:"MM/dd/yyyy hh:mm",language:"en"}),$("#end").datetimepicker({format:"MM/dd/yyyy hh:mm",language:"en"}),$("#event").on("input",function(){checkEmpty("event",!1)}),$("#eventtype").on("input",function(){checkEmpty("eventtype",!1)}),$("#start-time").on("input",function(){checkEmpty("start-time",!1),checkdate(isempty)}),$("#end-time").on("input",function(){checkEmpty("end-time",!1),checkdate(!1)}),$("#host").on("input",function(){checkEmpty("host",!1)}),$("#pac-input").on("input",function(){checkEmpty("pac-input",!1)}),document.querySelector("#addevent").onclick=function(){var e=!1;e=checkEmpty("event",e),e=checkEmpty("eventtype",e),e=checkEmpty("host",e),e=checkEmpty("start-time",e),e=checkEmpty("end-time",e),e=checkdate(e),e=checkEmpty("pac-input",e);var t=[],o=document.getElementById("guest");for(console.log(t.length),i=0;i<o.childNodes.length;i++){var n=o.childNodes[i].firstChild.nextSibling.value;""!==n?t.push(n):e=checkEmpty(o.childNodes[i].firstChild.nextSibling.id,e)}var r=new Firebase("https://boiling-heat-4273.firebaseio.com"),s=r.getAuth();if(console.log(e),s&&t.length>0&&!e){var a=new Firebase("https://boiling-heat-4273.firebaseio.com/web/planner/users/"+s.uid+"/events");a.push().set({eventname:document.getElementById("event").value,host:document.getElementById("host").value,start:document.getElementById("start-time").value,end:document.getElementById("end-time").value,guests:t,address:document.getElementById("pac-input").value,important:document.getElementById("switch").checked,note:document.getElementById("mtg").value}),returnToEvents()}};var authusername="",loggedin=!1,userid,ref=new Firebase("https://boiling-heat-4273.firebaseio.com"),url="https://boiling-heat-4273.firebaseio.com/web/planner/users/",loginWindow=document.querySelector("#tologin"),regWindow=document.querySelector("#toreg"),regUsernameInput=document.querySelector("#regusername");loginWindow.onclick=function(){document.getElementById("register-form").style.display="none",document.getElementById("login-form").style.display="block",document.getElementById("username").focus()},regWindow.onclick=function(){document.getElementById("login-form").style.display="none",document.getElementById("register-form").style.display="block",document.getElementById("regusername").focus()};var submitLogin=document.querySelector("#login-button"),submitReg=document.querySelector("#register-button"),firstPasswordInput=document.querySelector("#firstPassword"),secondPasswordInput=document.querySelector("#secondPassword");IssueTracker.prototype={add:function(e){this.issues.push(e)},retrieve:function(){var e="";switch(this.issues.length){case 0:break;case 1:e="Please correct the following issue:\n"+this.issues[0];break;default:e="Please correct the following issues:\n"+this.issues.join("\n")}return e}};var usernameError="",emailError="",firstInputIssuesTracker=new IssueTracker,secondInputIssuesTracker=new IssueTracker;$("#regusername").on("input",usernameValid),$("#email").on("input",emailValid),$("#firstPassword").on("input",firstPasswordValid),$("#secondPassword").on("input",secondPasswordValid),submitReg.onclick=function(){console.log("clicked sign up"),submitReg.setCustomValidity(""),usernameValid(),firstPasswordValid(),secondPasswordValid(),secondInputIssuesTracker.issues.length+firstInputIssuesTracker.issues.length===0&&""===usernameError&&""===emailError?(console.log("OK for now"),ref.createUser({email:document.querySelector("#email").value,password:secondPasswordInput.value},function(e,t){e?console.log(e):(console.log("Successfully created user account with uid:",t.uid),new Firebase(url).child(t.uid).set({username:regUsernameInput.value,email:document.getElementById("email").value,job:document.getElementById("job").value||"unfilled",events:[]}),ref.authWithPassword({email:document.getElementById("email").value,password:secondPasswordInput.value},function(e,t){e?console.log(e):(console.log("Authenticated successfully with payload:",t.uid),authusername=regUsernameInput.value,showComponents())}))})):(console.log("eeeeeeeerror"),submitReg.setCustomValidity("Please Validate Your Information."))};var loginuserError="",loginpassError="";$("#username").on("input",loginuserValid),$("#password").on("input",loginpassValid),submitLogin.onclick=function(){console.log("login validation"),loginuserValid(""),loginpassValid(""),0===loginuserError.length&&0===loginpassError.length&&ref.authWithPassword({email:document.querySelector("#username").value,password:document.querySelector("#password").value},function(e,t){e?(console.log(e),loginpassValid("Password is not correct.")):(console.log("Authenticated successfully with payload:",t.uid),userid=t.uid,new Firebase(url+t.uid+"/username").once("value",function(e){authusername=e.val(),console.log(authusername)}).then(function(){showComponents()}))})},$(".welcome input").tooltip({selector:"[title]",placement:"bottom",trigger:"focus",animation:!1});